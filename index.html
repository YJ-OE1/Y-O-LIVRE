<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<title>Youssef & Oumaima</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Great+Vibes&family=IM+Fell+English:ital@0;1&family=Montserrat:wght@300;400&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
:root{
  --gold:#c8a84b;
  --paper:#f7f0e0;
  --paper2:#ede5cc;
  --ink:#1e1208;
  --ink2:#4a3520;
}
html,body{
  width:100%;height:100%;overflow:hidden;
  background:#080402;
  font-family:'IM Fell English',serif;
}
#app{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;}
#stage{width:100%;height:100%;max-width:430px;position:relative;overflow:hidden;}

/* â•â•â• CANVAS OVERLAYS â•â•â• */
#smokeCanvas{position:absolute;inset:0;z-index:60;pointer-events:none;}
#soulsCanvas{position:fixed;inset:0;z-index:999;pointer-events:none;}

/* â•â•â• COVER â•â•â• */
#cover{
  position:absolute;inset:0;z-index:50;cursor:pointer;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  background:
    radial-gradient(ellipse at 30% 20%, rgba(120,70,20,0.18) 0%, transparent 50%),
    radial-gradient(ellipse at 70% 80%, rgba(80,30,5,0.25) 0%, transparent 45%),
    linear-gradient(170deg,
      #1a0c04 0%,
      #2c1508 8%,
      #3a1c0a 18%,
      #2e1609 30%,
      #3d1f0c 44%,
      #281408 58%,
      #341a0b 72%,
      #1e0f06 85%,
      #170b04 100%);
}
#cover::before{
  content:'';position:absolute;inset:0;pointer-events:none;z-index:1;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='6' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='0.38'/%3E%3C/svg%3E");
  background-size:220px;mix-blend-mode:overlay;opacity:0.7;
}
#cover::after{
  content:'';position:absolute;inset:0;pointer-events:none;z-index:2;
  background:
    radial-gradient(ellipse at 15% 15%, rgba(255,180,60,0.06) 0%, transparent 35%),
    radial-gradient(ellipse at 85% 85%, rgba(255,160,40,0.05) 0%, transparent 30%),
    radial-gradient(ellipse at 50% 50%, transparent 40%, rgba(0,0,0,0.35) 100%),
    repeating-linear-gradient(87deg, transparent, transparent 18px, rgba(0,0,0,0.012) 18px, rgba(0,0,0,0.012) 19px),
    repeating-linear-gradient(3deg, transparent, transparent 22px, rgba(255,200,80,0.008) 22px, rgba(255,200,80,0.008) 23px);
}

.cv-spine{
  position:absolute;left:0;top:0;bottom:0;width:26px;z-index:5;pointer-events:none;
  background:linear-gradient(90deg,
    rgba(0,0,0,0.7) 0%,
    rgba(80,35,8,0.5) 40%,
    rgba(60,25,5,0.2) 70%,
    transparent 100%);
}
.cv-spine::after{
  content:'';position:absolute;left:18px;top:0;bottom:0;width:1px;
  background:repeating-linear-gradient(to bottom,
    rgba(200,168,75,0.25) 0px, rgba(200,168,75,0.25) 5px,
    transparent 5px, transparent 10px);
}

.cv-frame{
  position:absolute;inset:12px;z-index:5;pointer-events:none;
  border:1.5px solid rgba(200,168,75,0.35);
  box-shadow:
    inset 0 0 30px rgba(0,0,0,0.5),
    0 0 0 1px rgba(0,0,0,0.4);
}
.cv-frame::before{
  content:'';position:absolute;inset:6px;
  border:0.5px solid rgba(200,168,75,0.15);
}
.cv-frame::after{
  content:'';position:absolute;inset:14px;
  border:0.5px solid rgba(200,168,75,0.08);
}

.cv-c{position:absolute;width:38px;height:38px;pointer-events:none;z-index:6;}
.cv-c svg{width:100%;height:100%;}
.cv-c.tl{top:12px;left:12px;}
.cv-c.tr{top:12px;right:12px;transform:scaleX(-1);}
.cv-c.bl{bottom:12px;left:12px;transform:scaleY(-1);}
.cv-c.br{bottom:12px;right:12px;transform:scale(-1);}

.cv-body{
  position:relative;z-index:6;
  display:flex;flex-direction:column;align-items:center;
  padding:20px 28px;text-align:center;width:100%;
}

.cv-label{
  font-family:'Cinzel',serif;
  font-size:clamp(0.44rem,1.9vw,0.56rem);
  letter-spacing:5px;text-transform:uppercase;
  color:rgba(200,168,75,0.55);
  margin-bottom:16px;
  text-shadow:0 1px 3px rgba(0,0,0,0.8),0 0 12px rgba(200,168,75,0.15);
}

.cv-names{
  font-family:'Great Vibes',cursive;
  font-size:clamp(3.6rem,15vw,5.6rem);
  color:#d4a843;
  line-height:1.05;
  text-shadow:
    0 2px 4px rgba(0,0,0,0.9),
    0 0 20px rgba(200,168,75,0.22),
    1px 1px 0 rgba(0,0,0,0.6),
    0 4px 16px rgba(0,0,0,0.7);
  filter:none;
  opacity:1;
}
.cv-amp{
  display:block;
  font-size:0.42em;
  color:rgba(200,168,75,0.65);
  margin:0px 0;
  text-shadow:0 1px 4px rgba(0,0,0,0.8);
}

.cv-div{
  width:140px;height:14px;
  margin:12px auto 10px;
  position:relative;
  flex-shrink:0;
}

.cv-date{
  font-family:'Cinzel',serif;
  font-size:clamp(0.55rem,2.4vw,0.72rem);
  letter-spacing:5px;
  color:rgba(200,168,75,0.72);
  text-transform:uppercase;
  text-shadow:0 1px 4px rgba(0,0,0,0.9),0 0 10px rgba(200,168,75,0.12);
}

.cv-seal{margin-top:20px;opacity:0.9;}

#hint-box{
  position:absolute;bottom:28px;width:100%;text-align:center;pointer-events:none;z-index:7;
}
#hint-text{
  font-family:'Cinzel',serif;
  font-size:clamp(0.55rem,2.5vw,0.7rem);
  letter-spacing:4px;text-transform:uppercase;
  color:rgba(200,168,75,0.65);
  display:inline-block;
  animation:breathe 2.4s ease-in-out infinite;
  text-shadow:0 1px 4px rgba(0,0,0,0.9);
}
@keyframes breathe{0%,100%{opacity:0.3;transform:scale(1)}50%{opacity:1;transform:scale(1.04)}}
#hint-icon{
  display:block;margin:0 auto 6px;
  font-size:1.4rem;
  animation:breathe2 2.4s ease-in-out infinite;
}
@keyframes breathe2{0%,100%{opacity:0.35;transform:scale(0.9)}50%{opacity:0.85;transform:scale(1.1)}}


#dustCanvas{
  position:absolute;inset:0;z-index:55;pointer-events:none;
}

#bookContainer{
  position:absolute;inset:0;
  display:none;
  overflow:hidden;
  perspective:2000px;
  perspective-origin:50% 50%;
}

.page{
  position:absolute;inset:0;
  display:none;
  pointer-events:none;
}
.page.visible{ display:block; pointer-events:auto; }

.pf,.pb{
  position:absolute;inset:0;
  overflow:hidden;
}
.pf{ background:var(--paper); }
.pb{ background:var(--paper2); }

.pf::after,.pb::after{
  content:'';position:absolute;inset:0;pointer-events:none;z-index:1;
  background:
    linear-gradient(to right, rgba(0,0,0,0.055) 0%, transparent 5%, transparent 95%, rgba(0,0,0,0.03) 100%),
    linear-gradient(to bottom, rgba(0,0,0,0.025) 0%, transparent 3%),
    repeating-linear-gradient(0deg,transparent,transparent 26px,rgba(160,140,100,0.09) 26px,rgba(160,140,100,0.09) 27px);
}

.pc{
  position:absolute;top:0;left:0;right:0;bottom:52px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:16px 22px 6px;
  color:var(--ink);z-index:2;overflow:hidden;
}
.pc-chapter{font-family:'Cinzel',serif;font-size:clamp(0.42rem,1.8vw,0.54rem);letter-spacing:5px;text-transform:uppercase;color:var(--gold);opacity:0.65;margin-bottom:3px;}
.pc-title{font-family:'Great Vibes',cursive;font-size:clamp(2rem,9vw,2.8rem);color:var(--ink);line-height:1.15;margin-bottom:2px;text-align:center;}
.pc-rule{display:flex;align-items:center;gap:6px;width:75%;margin:7px auto;}
.pc-rl{flex:1;height:1px;background:linear-gradient(90deg,transparent,rgba(200,168,75,0.32),transparent);}
.pc-rd{color:var(--gold);font-size:6px;opacity:0.5;}
.pc-body{font-family:'IM Fell English',serif;font-style:italic;font-size:clamp(0.88rem,3.8vw,1.05rem);color:var(--ink2);line-height:1.75;text-align:center;margin-top:6px;}
.pc-body.sm{font-size:clamp(0.78rem,3.3vw,0.92rem);}
.pc-body.plain{font-style:normal;}
.pc-folio{font-family:'Cinzel',serif;font-size:0.46rem;letter-spacing:3px;color:var(--ink2);opacity:0.28;margin-top:6px;}

.pg-nav{
  position:absolute;bottom:0;left:0;right:0;height:52px;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 14px;
  background:linear-gradient(to top, rgba(247,240,224,1) 60%, rgba(247,240,224,0) 100%);
  z-index:10;
  border-top:1px solid rgba(200,168,75,0.07);
}
.pb .pg-nav,
.paper2-nav{
  background:linear-gradient(to top, rgba(237,229,204,1) 60%, rgba(237,229,204,0) 100%);
}
.nav-btn{
  background:rgba(200,168,75,0.07);
  border:1px solid rgba(200,168,75,0.22);
  border-radius:50%;width:40px;height:40px;
  font-size:1.15rem;color:var(--gold);
  cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  user-select:none;
  transition:background 0.15s,transform 0.1s;
}
.nav-btn:active{background:rgba(200,168,75,0.2);transform:scale(0.92);}
.nav-btn:disabled{opacity:0.14;cursor:default;background:transparent;border-color:transparent;}
.nav-dots{display:flex;gap:6px;align-items:center;}
.dot{width:5px;height:5px;border-radius:50%;background:rgba(200,168,75,0.18);border:1px solid rgba(200,168,75,0.35);transition:all 0.25s;}
.dot.on{background:var(--gold);transform:scale(1.3);}

.cdown{display:flex;gap:10px;justify-content:center;margin:10px 0 6px;}
.cu{text-align:center;}
.cn{font-family:'Cinzel',serif;font-size:clamp(1.6rem,7vw,2.2rem);font-weight:600;color:var(--ink);line-height:1;display:block;}
.cl{font-family:'Montserrat',sans-serif;font-size:0.42rem;letter-spacing:2px;text-transform:uppercase;color:var(--ink2);opacity:0.55;}
.csep{font-size:1.1rem;color:var(--gold);align-self:center;margin-bottom:4px;opacity:0.4;}
.ring-w{margin:6px 0;filter:drop-shadow(0 3px 10px rgba(200,168,75,0.3));animation:rfloat 3.5s ease-in-out infinite;}
@keyframes rfloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
.vphoto{width:100%;height:clamp(110px,25vw,145px);object-fit:cover;border-radius:1px;box-shadow:0 2px 10px rgba(0,0,0,0.12);margin:6px 0;}

.nh-journey{display:flex;flex-direction:column;align-items:center;width:100%;padding:0 10px 60px;overflow-y:auto;overflow-x:hidden;flex:1;}
.nh-stop{display:flex;align-items:center;gap:8px;width:100%;animation:nhfade 0.8s ease both;}
.nh-stop-left{flex-direction:row;}
.nh-stop-right{flex-direction:row-reverse;}
.nh-img-wrap{position:relative;flex-shrink:0;}
.nh-img{width:clamp(88px,22vw,115px);height:clamp(70px,17vw,92px);object-fit:cover;border-radius:3px;box-shadow:0 3px 14px rgba(0,0,0,0.22);border:2px solid rgba(200,168,75,0.35);}
.nh-pin{position:absolute;top:-8px;right:-6px;font-size:0.85rem;filter:drop-shadow(0 1px 2px rgba(0,0,0,0.3));}
.nh-label{display:flex;flex-direction:column;gap:3px;flex:1;}
.nh-stop-right .nh-label{text-align:right;}
.nh-place{font-family:'Cinzel',serif;font-size:clamp(0.38rem,1.5vw,0.47rem);color:#b8985a;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:3px;}
.nh-caption{font-family:'Palatino Linotype','Palatino',Georgia,serif;font-size:clamp(0.48rem,1.9vw,0.58rem);color:var(--ink2);opacity:0.78;font-style:italic;line-height:1.5;}
.nh-path{width:85%;flex-shrink:0;}
.nh-svg{width:100%;height:38px;display:block;}
.nh-heart{font-size:1.3rem;color:var(--gold);opacity:0.8;margin-top:4px;animation:hb 2s ease-in-out infinite;}
@keyframes nhfade{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.mframe{width:100%;height:clamp(110px,25vw,140px);border:none;border-radius:1px;margin:6px 0;}
.btn-dir{display:inline-block;padding:6px 18px;border:1px solid rgba(200,168,75,0.35);color:var(--gold);font-family:'Cinzel',serif;font-size:0.5rem;letter-spacing:3px;text-transform:uppercase;text-decoration:none;cursor:pointer;margin-top:6px;background:transparent;}
.irow{display:flex;align-items:center;gap:7px;font-family:'Montserrat',sans-serif;font-size:clamp(0.58rem,2.5vw,0.68rem);color:var(--ink2);margin:2px 0;}
.ico{color:var(--gold);font-size:0.82rem;}
.prog{width:100%;text-align:left;margin-top:8px;}
.prog-row{display:flex;align-items:flex-start;gap:10px;margin-bottom:9px;padding-bottom:9px;border-bottom:1px solid rgba(200,168,75,0.09);}
.prog-row:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0;}
.prog-t{font-family:'Cinzel',serif;font-size:0.5rem;letter-spacing:1px;color:var(--gold);min-width:34px;padding-top:3px;}
.prog-ev{font-family:'IM Fell English',serif;font-size:clamp(0.85rem,3.5vw,1rem);font-style:italic;color:var(--ink);}
.prog-sub{font-family:'Montserrat',sans-serif;font-size:0.5rem;color:var(--ink2);opacity:0.6;}
@keyframes hb{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}

/* â•â•â• PAGE 6 â€” plume + coeur â•â•â• */
.pg6-scene{
  position:relative;
  width:clamp(180px,50vw,220px);
  margin:0 auto 6px;
  /* hauteur = taille du coeur + dÃ©bordement plume en haut */
  height:clamp(190px,52vw,240px);
}
/* Le coeur en bas du conteneur */
.pg6-heart{
  position:absolute;
  bottom:0;left:50%;transform:translateX(-50%);
  width:clamp(150px,42vw,190px);
  mix-blend-mode:multiply;
  opacity:0.88;
  filter:sepia(0.3) contrast(1.05);
  animation:heartPulse 3s ease-in-out infinite;
}
/* La plume positionnÃ©e en haut-droite du coeur, pointe vers le centre-haut du coeur */
.pg6-quill{
  position:absolute;
  /* pointe de la plume vers le haut-droit du coeur, corps en dehors */
  bottom: clamp(150px, 26vw, 120px);
  right: clamp(148px, 0vw, 0px);
  width:clamp(80px,22vw,105px);
  mix-blend-mode:multiply;
  opacity:0.88;
  filter:sepia(0.35) contrast(1.1);
  /* pointe vers le bas-gauche = rotation ~210deg = la plume "Ã©crit" le coeur */
  transform:rotate(30deg);
  animation:quillDraw 4s ease-in-out infinite;
  transform-origin: bottom center; /* pivot Ã  la pointe */
}
@keyframes quillDraw{
  0%,100%{ transform:rotate(30deg) translate(0,0); }
  50%{     transform:rotate(27deg) translate(1px,-3px); }
}
@keyframes heartPulse{0%,100%{transform:translateX(-50%) scale(1)}50%{transform:translateX(-50%) scale(1.04)}}
@keyframes quillFloat{0%,100%{transform:rotate(-18deg) translateX(18px) translateY(0)}50%{transform:rotate(-16deg) translateX(18px) translateY(-6px)}}
</style>
</head>
<body>

<canvas id="smokeCanvas"></canvas>
<canvas id="dustCanvas"></canvas>
<canvas id="soulsCanvas"></canvas>

<div id="app">
<div id="stage">

<!-- COVER -->
<div id="cover">
  <div class="cv-spine"></div>
  <div class="cv-frame"></div>

  <div class="cv-c tl"><svg viewBox="0 0 40 40">
    <path d="M2 2 L32 2 L2 32 Z" fill="none" stroke="rgba(200,168,75,0.5)" stroke-width="0.8"/>
    <path d="M2 2 L22 2 L2 22 Z" fill="rgba(200,168,75,0.06)" stroke="rgba(200,168,75,0.3)" stroke-width="0.5"/>
    <line x1="2" y1="2" x2="2" y2="36" stroke="rgba(200,168,75,0.35)" stroke-width="0.7"/>
    <line x1="2" y1="2" x2="36" y2="2" stroke="rgba(200,168,75,0.35)" stroke-width="0.7"/>
    <circle cx="2" cy="2" r="1.8" fill="rgba(200,168,75,0.5)"/>
    <circle cx="14" cy="2" r="1" fill="rgba(200,168,75,0.2)"/>
    <circle cx="2" cy="14" r="1" fill="rgba(200,168,75,0.2)"/>
    <path d="M8 2 Q12 6 8 10 Q4 6 8 2Z" fill="rgba(200,168,75,0.12)" stroke="rgba(200,168,75,0.22)" stroke-width="0.4"/>
  </svg></div>
  <div class="cv-c tr"><svg viewBox="0 0 40 40" style="transform:scaleX(-1)">
    <path d="M2 2 L32 2 L2 32 Z" fill="none" stroke="rgba(200,168,75,0.5)" stroke-width="0.8"/>
    <path d="M2 2 L22 2 L2 22 Z" fill="rgba(200,168,75,0.06)" stroke="rgba(200,168,75,0.3)" stroke-width="0.5"/>
    <line x1="2" y1="2" x2="2" y2="36" stroke="rgba(200,168,75,0.35)" stroke-width="0.7"/>
    <line x1="2" y1="2" x2="36" y2="2" stroke="rgba(200,168,75,0.35)" stroke-width="0.7"/>
    <circle cx="2" cy="2" r="1.8" fill="rgba(200,168,75,0.5)"/>
    <circle cx="14" cy="2" r="1" fill="rgba(200,168,75,0.2)"/>
    <circle cx="2" cy="14" r="1" fill="rgba(200,168,75,0.2)"/>
    <path d="M8 2 Q12 6 8 10 Q4 6 8 2Z" fill="rgba(200,168,75,0.12)" stroke="rgba(200,168,75,0.22)" stroke-width="0.4"/>
  </svg></div>
  <div class="cv-c bl"><svg viewBox="0 0 40 40" style="transform:scaleY(-1)">
    <path d="M2 2 L32 2 L2 32 Z" fill="none" stroke="rgba(200,168,75,0.5)" stroke-width="0.8"/>
    <path d="M2 2 L22 2 L2 22 Z" fill="rgba(200,168,75,0.06)" stroke="rgba(200,168,75,0.3)" stroke-width="0.5"/>
    <line x1="2" y1="2" x2="2" y2="36" stroke="rgba(200,168,75,0.35)" stroke-width="0.7"/>
    <line x1="2" y1="2" x2="36" y2="2" stroke="rgba(200,168,75,0.35)" stroke-width="0.7"/>
    <circle cx="2" cy="2" r="1.8" fill="rgba(200,168,75,0.5)"/>
    <circle cx="14" cy="2" r="1" fill="rgba(200,168,75,0.2)"/>
    <circle cx="2" cy="14" r="1" fill="rgba(200,168,75,0.2)"/>
    <path d="M8 2 Q12 6 8 10 Q4 6 8 2Z" fill="rgba(200,168,75,0.12)" stroke="rgba(200,168,75,0.22)" stroke-width="0.4"/>
  </svg></div>
  <div class="cv-c br"><svg viewBox="0 0 40 40" style="transform:scale(-1)">
    <path d="M2 2 L32 2 L2 32 Z" fill="none" stroke="rgba(200,168,75,0.5)" stroke-width="0.8"/>
    <path d="M2 2 L22 2 L2 22 Z" fill="rgba(200,168,75,0.06)" stroke="rgba(200,168,75,0.3)" stroke-width="0.5"/>
    <line x1="2" y1="2" x2="2" y2="36" stroke="rgba(200,168,75,0.35)" stroke-width="0.7"/>
    <line x1="2" y1="2" x2="36" y2="2" stroke="rgba(200,168,75,0.35)" stroke-width="0.7"/>
    <circle cx="2" cy="2" r="1.8" fill="rgba(200,168,75,0.5)"/>
    <circle cx="14" cy="2" r="1" fill="rgba(200,168,75,0.2)"/>
    <circle cx="2" cy="14" r="1" fill="rgba(200,168,75,0.2)"/>
    <path d="M8 2 Q12 6 8 10 Q4 6 8 2Z" fill="rgba(200,168,75,0.12)" stroke="rgba(200,168,75,0.22)" stroke-width="0.4"/>
  </svg></div>

  <div class="cv-body">

    <svg width="88%" height="18" viewBox="0 0 260 18" style="margin-bottom:10px;flex-shrink:0;">
      <line x1="0" y1="9" x2="90" y2="9" stroke="rgba(200,168,75,0.4)" stroke-width="0.6"/>
      <path d="M95 9 L100 4 L105 9 L100 14 Z" fill="rgba(200,168,75,0.35)" stroke="rgba(200,168,75,0.5)" stroke-width="0.5"/>
      <path d="M110 9 L113 5.5 L116 9 L113 12.5 Z" fill="none" stroke="rgba(200,168,75,0.3)" stroke-width="0.5"/>
      <circle cx="130" cy="9" r="3.5" fill="none" stroke="rgba(200,168,75,0.45)" stroke-width="0.7"/>
      <circle cx="130" cy="9" r="1.2" fill="rgba(200,168,75,0.5)"/>
      <path d="M144 9 L147 5.5 L150 9 L147 12.5 Z" fill="none" stroke="rgba(200,168,75,0.3)" stroke-width="0.5"/>
      <path d="M155 9 L160 4 L165 9 L160 14 Z" fill="rgba(200,168,75,0.35)" stroke="rgba(200,168,75,0.5)" stroke-width="0.5"/>
      <line x1="170" y1="9" x2="260" y2="9" stroke="rgba(200,168,75,0.4)" stroke-width="0.6"/>
    </svg>

    <div class="cv-label">Invitation au Mariage</div>

    <svg width="90" height="90" viewBox="0 0 90 90" style="margin-bottom:6px;flex-shrink:0;">
      <circle cx="45" cy="45" r="42" fill="none" stroke="rgba(200,168,75,0.3)" stroke-width="0.7" stroke-dasharray="3 2"/>
      <circle cx="45" cy="45" r="38" fill="none" stroke="rgba(200,168,75,0.2)" stroke-width="0.5"/>
      <path d="M45 8 L48 34 L45 38 L42 34 Z" fill="rgba(200,168,75,0.18)" stroke="rgba(200,168,75,0.4)" stroke-width="0.5"/>
      <path d="M82 45 L56 48 L52 45 L56 42 Z" fill="rgba(200,168,75,0.18)" stroke="rgba(200,168,75,0.4)" stroke-width="0.5"/>
      <path d="M45 82 L42 56 L45 52 L48 56 Z" fill="rgba(200,168,75,0.18)" stroke="rgba(200,168,75,0.4)" stroke-width="0.5"/>
      <path d="M8 45 L34 42 L38 45 L34 48 Z" fill="rgba(200,168,75,0.18)" stroke="rgba(200,168,75,0.4)" stroke-width="0.5"/>
      <path d="M70 20 L52 40 L48 38 L56 22 Z" fill="rgba(200,168,75,0.12)" stroke="rgba(200,168,75,0.3)" stroke-width="0.4"/>
      <path d="M70 70 L50 52 L52 48 L68 56 Z" fill="rgba(200,168,75,0.12)" stroke="rgba(200,168,75,0.3)" stroke-width="0.4"/>
      <path d="M20 70 L38 50 L42 52 L22 68 Z" fill="rgba(200,168,75,0.12)" stroke="rgba(200,168,75,0.3)" stroke-width="0.4"/>
      <path d="M20 20 L40 40 L38 44 L22 34 Z" fill="rgba(200,168,75,0.12)" stroke="rgba(200,168,75,0.3)" stroke-width="0.4"/>
      <circle cx="45" cy="45" r="18" fill="rgba(30,12,3,0.6)" stroke="rgba(200,168,75,0.45)" stroke-width="0.8"/>
      <circle cx="45" cy="45" r="14" fill="none" stroke="rgba(200,168,75,0.2)" stroke-width="0.4"/>
      <path d="M45 52 C45 52 34 44 34 38 C34 33 38.5 30 41 32 C42.5 33 45 36 45 36 C45 36 47.5 33 49 32 C51.5 30 56 33 56 38 C56 44 45 52 45 52Z"
        fill="rgba(200,168,75,0.28)" stroke="rgba(200,168,75,0.55)" stroke-width="0.7"/>
    </svg>

    <div class="cv-names">Youssef<span class="cv-amp">&amp;</span>Oumaima</div>

    <div class="cv-div">
      <svg width="100%" height="14" viewBox="0 0 140 14">
        <line x1="0" y1="7" x2="50" y2="7" stroke="rgba(200,168,75,0.45)" stroke-width="0.6"/>
        <path d="M54 7 L58 3 L62 7 L58 11 Z" fill="rgba(200,168,75,0.4)" stroke="rgba(200,168,75,0.55)" stroke-width="0.5"/>
        <path d="M65 7 L68 4 L71 7 L68 10 Z" fill="none" stroke="rgba(200,168,75,0.35)" stroke-width="0.5"/>
        <circle cx="75" cy="7" r="1.8" fill="rgba(200,168,75,0.55)"/>
        <path d="M79 7 L82 4 L85 7 L82 10 Z" fill="none" stroke="rgba(200,168,75,0.35)" stroke-width="0.5"/>
        <path d="M88 7 L92 3 L96 7 L92 11 Z" fill="rgba(200,168,75,0.4)" stroke="rgba(200,168,75,0.55)" stroke-width="0.5"/>
        <line x1="100" y1="7" x2="140" y2="7" stroke="rgba(200,168,75,0.45)" stroke-width="0.6"/>
      </svg>
    </div>

    <div class="cv-date">Samedi Â· 4 Avril Â· 2026</div>

    <div class="cv-seal">
      <svg width="62" height="62" viewBox="0 0 62 62">
        <ellipse cx="31" cy="58" rx="12" ry="4" fill="rgba(90,15,15,0.4)"/>
        <circle cx="31" cy="31" r="26" fill="url(#waxGrad)"/>
        <defs>
          <radialGradient id="waxGrad" cx="38%" cy="35%" r="60%">
            <stop offset="0%" stop-color="#8b2020"/>
            <stop offset="50%" stop-color="#6b1515"/>
            <stop offset="100%" stop-color="#4a0d0d"/>
          </radialGradient>
        </defs>
        <circle cx="31" cy="31" r="23" fill="none" stroke="rgba(200,168,75,0.4)" stroke-width="0.8"/>
        <circle cx="31" cy="31" r="20" fill="none" stroke="rgba(200,168,75,0.2)" stroke-width="0.4"/>
        <text x="31" y="27" text-anchor="middle" font-family="'Great Vibes',cursive" font-size="11" fill="rgba(220,185,80,0.9)" letter-spacing="1">Y</text>
        <text x="31" y="38" text-anchor="middle" font-family="'Great Vibes',cursive" font-size="11" fill="rgba(220,185,80,0.9)" letter-spacing="1">&amp; O</text>
        <ellipse cx="24" cy="22" rx="5" ry="3" fill="rgba(255,255,255,0.06)" transform="rotate(-25,24,22)"/>
      </svg>
    </div>

    <svg width="88%" height="18" viewBox="0 0 260 18" style="margin-top:8px;flex-shrink:0;">
      <line x1="0" y1="9" x2="90" y2="9" stroke="rgba(200,168,75,0.4)" stroke-width="0.6"/>
      <path d="M95 9 L100 4 L105 9 L100 14 Z" fill="rgba(200,168,75,0.35)" stroke="rgba(200,168,75,0.5)" stroke-width="0.5"/>
      <path d="M110 9 L113 5.5 L116 9 L113 12.5 Z" fill="none" stroke="rgba(200,168,75,0.3)" stroke-width="0.5"/>
      <circle cx="130" cy="9" r="3.5" fill="none" stroke="rgba(200,168,75,0.45)" stroke-width="0.7"/>
      <circle cx="130" cy="9" r="1.2" fill="rgba(200,168,75,0.5)"/>
      <path d="M144 9 L147 5.5 L150 9 L147 12.5 Z" fill="none" stroke="rgba(200,168,75,0.3)" stroke-width="0.5"/>
      <path d="M155 9 L160 4 L165 9 L160 14 Z" fill="rgba(200,168,75,0.35)" stroke="rgba(200,168,75,0.5)" stroke-width="0.5"/>
      <line x1="170" y1="9" x2="260" y2="9" stroke="rgba(200,168,75,0.4)" stroke-width="0.6"/>
    </svg>

  </div>

  <div id="hint-box">
    <span id="hint-icon">ğŸ–</span>
    <span id="hint-text">Toucher pour ouvrir</span>
  </div>
</div>

<!-- PAGES -->
<div id="bookContainer">

  <!-- Page 1 -->
  <div class="page visible" id="pg0">
    <div class="pf">
      <div class="pc" style="justify-content:center;">
        <div class="pc-chapter">Chapitre I</div>
        <svg width="40" height="40" viewBox="0 0 60 60" style="margin:4px 0 8px;"><circle cx="30" cy="30" r="26" stroke="rgba(200,168,75,0.2)" stroke-width="0.6" fill="none"/><path d="M30 4C33 14 42 18 30 30C18 18 27 14 30 4Z" fill="rgba(200,168,75,0.09)" stroke="rgba(200,168,75,0.25)" stroke-width="0.5"/><path d="M56 30C46 33 42 42 30 30C42 18 46 27 56 30Z" fill="rgba(200,168,75,0.09)" stroke="rgba(200,168,75,0.25)" stroke-width="0.5"/><path d="M30 56C27 46 18 42 30 30C42 42 33 46 30 56Z" fill="rgba(200,168,75,0.09)" stroke="rgba(200,168,75,0.25)" stroke-width="0.5"/><path d="M4 30C14 27 18 18 30 30C18 42 14 33 4 30Z" fill="rgba(200,168,75,0.09)" stroke="rgba(200,168,75,0.25)" stroke-width="0.5"/><circle cx="30" cy="30" r="3" fill="rgba(200,168,75,0.35)"/></svg>
        <div class="pc-title" style="font-size:clamp(2.2rem,10vw,3rem);">Youssef<br><span style="font-size:0.55em;color:var(--ink2);">&amp;</span><br>Oumaima</div>
        <div class="pc-rule"><div class="pc-rl"></div><div class="pc-rd">â—†</div><div class="pc-rl"></div></div>
        <p class="pc-body plain sm" style="font-family:'Cinzel',serif;font-size:clamp(0.48rem,2vw,0.6rem);letter-spacing:4px;opacity:0.5;margin-top:2px;">INVITATION AU MARIAGE</p>
        <p class="pc-body sm" style="margin-top:10px;opacity:0.62;">Nous avons l'honneur de vous convier<br>Ã  cÃ©lÃ©brer avec nous le plus beau<br>jour de notre vie.</p>
        <div class="pc-folio" style="margin-top:10px;">I</div>
      </div>
      <div class="pg-nav">
        <button class="nav-btn" id="btn0l">&#8592;</button>
        <div class="nav-dots" id="d0"></div>
        <button class="nav-btn" id="btn0r">&#8594;</button>
      </div>
    </div>
  </div>

  <!-- Page 2 -->
  <div class="page" id="pg1">
    <div class="pf">
      <div class="pc" style="justify-content:flex-start;padding:0;overflow:hidden;">

        <div style="text-align:center;padding:14px 16px 2px;width:100%;flex-shrink:0;">
          <div class="pc-chapter">Chapitre II</div>
          <div class="pc-title">Notre Histoire</div>
          <div class="pc-rule"><div class="pc-rl"></div><div class="pc-rd">&#9670;</div><div class="pc-rl"></div></div>
        </div>

        <div class="nh-journey">

          <div class="nh-stop nh-stop-left" style="animation-delay:0.1s">
            <div class="nh-img-wrap">
            <img src="assets/photo1.png" class="nh-img">
              <div class="nh-pin">&#128205;</div>
            </div>
            <div class="nh-label">
              <span class="nh-place">Il &eacute;tait une fois&hellip;</span>
              <span class="nh-caption">parmi des millions d&rsquo;&eacute;toiles dans le ciel,<br>l&rsquo;univers a choisi de te mettre<br>sur mon chemin.</span>
            </div>
          </div>

          <div class="nh-path">
            <svg class="nh-svg" viewBox="0 0 200 48" preserveAspectRatio="none">
              <path d="M 15 8 Q 100 44 185 8" stroke="#b8985a" stroke-width="2.2"
                stroke-dasharray="6 5" fill="none" stroke-linecap="round"/>
              <text x="100" y="32" text-anchor="middle" font-family="serif"
                font-size="13" fill="#b8985a" opacity="0.75">&#9992;</text>
            </svg>
          </div>

          <div class="nh-stop nh-stop-right" style="animation-delay:0.25s">
            <div class="nh-img-wrap">
              <img src="assets/photo2.png" class="nh-img">
              <div class="nh-pin">&#128205;</div>
            </div>
            <div class="nh-label">
              <span class="nh-place">Dans le silence de l&rsquo;&acirc;me&hellip;</span>
              <span class="nh-caption">je cherchais quelque chose<br>sans savoir que c&rsquo;&eacute;tait toi<br>que je cherchais.</span>
            </div>
          </div>

          <div class="nh-path">
            <svg class="nh-svg" viewBox="0 0 200 48" preserveAspectRatio="none">
              <path d="M 15 8 Q 100 44 185 8" stroke="#b8985a" stroke-width="2.2"
                stroke-dasharray="6 5" fill="none" stroke-linecap="round"/>
              <text x="100" y="32" text-anchor="middle" font-family="serif"
                font-size="12" fill="#b8985a" opacity="0.75">&#128014;</text>
            </svg>
          </div>

          <div class="nh-stop nh-stop-left" style="animation-delay:0.4s">
            <div class="nh-img-wrap">
              <img src="assets/photo3.png" class="nh-img">
              <div class="nh-pin">&#128205;</div>
            </div>
            <div class="nh-label">
              <span class="nh-place">Et depuis ce jour-l&agrave;&hellip;</span>
              <span class="nh-caption">chaque aventure a un go&ucirc;t de miracle,<br>chaque regard dit ce que<br>les mots n&rsquo;osent pas.</span>
            </div>
          </div>

          <div class="nh-heart">&#9829;</div>

        </div>

        <div class="pc-folio" style="position:absolute;bottom:52px;left:50%;transform:translateX(-50%);">II</div>
      </div>
      <div class="pg-nav">
        <button class="nav-btn" id="btn1l">&#8592;</button>
        <div class="nav-dots" id="d1"></div>
        <button class="nav-btn" id="btn1r">&#8594;</button>
      </div>
    </div>
  </div>

  <!-- Page 3 -->
  <div class="page" id="pg2">
    <div class="pf">
      <div class="pc">
        <div class="pc-chapter">Le Lieu</div>
        <div class="pc-title">Notre Salle</div>
        <div class="pc-rule"><div class="pc-rl"></div><div class="pc-rd">â—†</div><div class="pc-rl"></div></div>
        <img class="vphoto" src="assets/notreSalle.jpeg" alt="Salle"/>
        <div class="irow"><span class="ico">ğŸ“</span>Casablanca, Maroc</div>
        <div class="irow"><span class="ico">ğŸ•–</span>Samedi 4 Avril 2026 Â· 19h00</div>
        <div class="irow"><span class="ico">âœ¨</span>SoirÃ©e de Gala</div>
        <a href="https://maps.app.goo.gl/V8ewxEcuPoiRUozn9" target="_blank" class="btn-dir" style="display:inline-flex;align-items:center;gap:6px;margin-top:10px;">ğŸ“ Voir sur Google Maps â†’</a>
        <div class="pc-folio" style="margin-top:8px;">III</div>
      </div>
      <div class="pg-nav">
        <button class="nav-btn" id="btn2l">&#8592;</button>
        <div class="nav-dots" id="d2"></div>
        <button class="nav-btn" id="btn2r">&#8594;</button>
      </div>
    </div>
  </div>

  <!-- Page 4 -->
  <div class="page" id="pg3">
    <div class="pf" style="background:var(--paper2);">
      <div class="pc" style="justify-content:center;">
        <div class="pc-chapter">Plus que...</div>
        <div class="pc-title">Le Grand Jour</div>
        <div class="pc-rule"><div class="pc-rl"></div><div class="pc-rd">â—†</div><div class="pc-rl"></div></div>
        <div class="cdown" id="countdown">
          <div class="cu"><span class="cn" id="cdj">--</span><span class="cl">Jours</span></div>
          <div class="csep">Â·</div>
          <div class="cu"><span class="cn" id="cdh">--</span><span class="cl">H</span></div>
          <div class="csep">Â·</div>
          <div class="cu"><span class="cn" id="cdm">--</span><span class="cl">Min</span></div>
          <div class="csep">Â·</div>
          <div class="cu"><span class="cn" id="cds">--</span><span class="cl">Sec</span></div>
        </div>
        <div class="ring-w">
          <svg width="70" height="70" viewBox="0 0 160 160"><defs><linearGradient id="gG" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#f5d27a"/><stop offset="40%" stop-color="#e8b84b"/><stop offset="60%" stop-color="#c8922a"/><stop offset="100%" stop-color="#f5d27a"/></linearGradient><linearGradient id="dG" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#e8f4ff"/><stop offset="50%" stop-color="#8fc8f0"/><stop offset="100%" stop-color="#deeeff"/></linearGradient></defs><ellipse cx="80" cy="112" rx="38" ry="10" fill="none" stroke="url(#gG)" stroke-width="7"/><line x1="42" y1="112" x2="42" y2="72" stroke="url(#gG)" stroke-width="7"/><line x1="118" y1="112" x2="118" y2="72" stroke="url(#gG)" stroke-width="7"/><ellipse cx="80" cy="72" rx="38" ry="10" fill="url(#gG)"/><polygon points="80,30 92,52 80,48 68,52" fill="url(#dG)" stroke="#8fb8d8" stroke-width="1"/><polygon points="80,30 92,52 80,44" fill="rgba(255,255,255,0.65)"/><polygon points="80,48 92,52 80,58 68,52" fill="url(#dG)" stroke="#8fb8d8" stroke-width="1"/></svg>
        </div>
        <p class="pc-body sm" style="opacity:0.5;">Casablanca Â· Maroc</p>
        <div class="pc-folio" style="margin-top:6px;">IV</div>
      </div>
      <div class="pg-nav" style="background:linear-gradient(to top,rgba(237,229,204,1) 60%,rgba(237,229,204,0) 100%);">
        <button class="nav-btn" id="btn3l">&#8592;</button>
        <div class="nav-dots" id="d3"></div>
        <button class="nav-btn" id="btn3r">&#8594;</button>
      </div>
    </div>
  </div>

  <!-- Page 5 -->
  <div class="page" id="pg4">
    <div class="pf">
      <div class="pc" style="justify-content:center;">
        <div class="pc-chapter">Ã‰pilogue</div>
        <div class="pc-title">Avec Amour</div>
        <div class="pc-rule"><div class="pc-rl"></div><div class="pc-rd">â—†</div><div class="pc-rl"></div></div>
        <p class="pc-body" style="margin-top:8px;">Votre prÃ©sence est le plus beau<br>des cadeaux que vous puissiez<br>nous offrir.</p>
        <div style="margin:16px 0;font-family:'Great Vibes',cursive;font-size:clamp(1.6rem,7vw,2.2rem);color:var(--ink2);text-align:center;">Youssef &amp; Oumaima</div>
        <div class="pc-rule"><div class="pc-rl"></div><div class="pc-rd">â—†</div><div class="pc-rl"></div></div>
        <p class="pc-body sm" style="margin-top:10px;opacity:0.58;">Nous vous attendons avec impatience<br>le 4 Avril 2026.</p>
        <div class="pc-folio" style="margin-top:10px;">V</div>
      </div>
      <div class="pg-nav">
        <button class="nav-btn" id="btn4l">&#8592;</button>
        <div class="nav-dots" id="d4"></div>
        <button class="nav-btn" id="btn4r">&#8594;</button>
      </div>
    </div>
  </div>

  <!-- Page 6 â€” Not The End -->
  <div class="page" id="pg5">
    <div class="pf" style="background:var(--paper);">
      <div class="pc" style="justify-content:center;gap:0;">

        <!-- Plume + Coeur groupÃ©s dans un seul conteneur relatif -->
        <div class="pg6-scene">
          <!-- Coeur empreinte en bas -->
          <img src="assets/coeur.png" alt="coeur empreinte" class="pg6-heart">
          <!-- Plume superposÃ©e, pointe vers le haut du coeur -->
          <img src="assets/plume.png" alt="plume" class="pg6-quill">
        </div>

        <!-- NOT THE END -->
        <div style="text-align:center;margin-top:4px;">
          <div style="font-family:'Cinzel',serif;font-size:clamp(0.38rem,1.6vw,0.48rem);
                      letter-spacing:6px;color:var(--gold);opacity:0.5;text-transform:uppercase;
                      margin-bottom:4px;">â€” mais plutÃ´t â€”</div>
          <div style="font-family:'Great Vibes',cursive;
                      font-size:clamp(2.8rem,13vw,4.2rem);
                      color:var(--ink);line-height:1;
                      text-shadow:0 2px 8px rgba(0,0,0,0.08);">Not The End</div>
          <div style="font-family:'Cinzel',serif;font-size:clamp(0.38rem,1.6vw,0.48rem);
                      letter-spacing:5px;color:var(--gold);opacity:0.45;text-transform:uppercase;
                      margin-top:6px;">le dÃ©but de tout</div>
        </div>

        <div class="pc-rule" style="margin-top:14px;"><div class="pc-rl"></div><div class="pc-rd">â—†</div><div class="pc-rl"></div></div>

        <p class="pc-body sm" style="margin-top:8px;opacity:0.55;font-size:clamp(0.72rem,3vw,0.84rem);">
          Youssef &amp; Oumaima<br>
          <span style="font-family:'Cinzel',serif;font-size:0.46rem;letter-spacing:3px;opacity:0.7;">4 Â· 04 Â· 2026</span>
        </p>

        <div class="pc-folio" style="margin-top:10px;">VI</div>
      </div>
      <div class="pg-nav">
        <button class="nav-btn" id="btn5l">&#8592;</button>
        <div class="nav-dots" id="d5"></div>
        <button class="nav-btn" disabled>&#8594;</button>
      </div>
    </div>
  </div>

</div><!-- /bookContainer -->
</div><!-- /stage -->
</div><!-- /app -->

<script>
document.head.insertAdjacentHTML('beforeend','<style>@keyframes hb{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}</style>');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DUST PARTICLE SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DC = document.getElementById('dustCanvas');
const DX = DC.getContext('2d');
let dustParticles = [];
let dustRAF = null;
let dustSettled = true;
let dustCleared = false;

function resizeDustCanvas(){
  const stage = document.getElementById('stage');
  DC.width = stage.offsetWidth;
  DC.height = stage.offsetHeight;
}
resizeDustCanvas();
window.addEventListener('resize', resizeDustCanvas);

function initDust(){
  dustParticles = [];
  const W = DC.width, H = DC.height;
  for(let i = 0; i < 280; i++){
    dustParticles.push({
      x: Math.random() * W,
      y: Math.random() * H,
      r: 0.6 + Math.random() * 2.2,
      alpha: 0.05 + Math.random() * 0.22,
      settled: true,
      vx: 0, vy: 0,
      life: 1.0,
      decay: 0,
      hue: Math.random() < 0.3 ? 40 : 0,
      sat: Math.random() < 0.3 ? 20 : 0,
    });
  }
}

function drawDust(){
  DX.clearRect(0, 0, DC.width, DC.height);
  let anyAlive = false;

  for(let p of dustParticles){
    if(p.life <= 0) continue;
    anyAlive = true;

    if(!p.settled){
      p.x += p.vx;
      p.y += p.vy;
      p.vx *= 0.97;
      p.vy *= 0.97;
      p.vy -= 0.04;
      p.vx += (Math.random() - 0.5) * 0.15;
      p.r += 0.01;
      p.life -= p.decay;
    }

    const a = p.life * p.alpha;
    if(a <= 0) continue;

    const color = p.hue > 0
      ? `hsla(${p.hue},${p.sat}%,85%,${a})`
      : `rgba(210,190,155,${a})`;

    DX.beginPath();
    DX.arc(p.x, p.y, p.r, 0, Math.PI*2);
    DX.fillStyle = color;
    DX.fill();
  }

  if(anyAlive){
    dustRAF = requestAnimationFrame(drawDust);
  } else {
    DX.clearRect(0, 0, DC.width, DC.height);
    dustParticles = [];
    dustRAF = null;
  }
}

function blowDust(cx, cy){
  if(dustCleared) return;
  dustCleared = true;

  for(let p of dustParticles){
    p.settled = false;
    const dx = p.x - cx;
    const dy = p.y - cy;
    const dist = Math.sqrt(dx*dx + dy*dy) + 0.1;
    const force = (150 / (dist + 80)) + 0.5;
    const ang = Math.atan2(dy, dx) + (Math.random()-0.5)*1.2;
    p.vx = Math.cos(ang) * force * (0.5 + Math.random());
    p.vy = Math.sin(ang) * force * (0.3 + Math.random()) - 0.8;
    p.decay = 0.006 + Math.random() * 0.012;
    p.alpha = p.alpha * 0.85;
  }

  if(!dustRAF) dustRAF = requestAnimationFrame(drawDust);
}

function drawDustVignette(){
  const W = DC.width, H = DC.height;
  const film = DX.createRadialGradient(W/2,H/2,0, W/2,H/2,Math.max(W,H)*0.7);
  film.addColorStop(0,'rgba(180,155,90,0.0)');
  film.addColorStop(1,'rgba(120,100,60,0.08)');
  DX.fillStyle = film;
  DX.fillRect(0,0,W,H);
}

initDust();
(function renderSettledDust(){
  DX.clearRect(0,0,DC.width,DC.height);
  for(let p of dustParticles){
    const a = p.alpha;
    const color = p.hue > 0
      ? `hsla(${p.hue},${p.sat}%,85%,${a})`
      : `rgba(210,190,155,${a})`;
    DX.beginPath();
    DX.arc(p.x, p.y, p.r, 0, Math.PI*2);
    DX.fillStyle = color;
    DX.fill();
  }
  drawDustVignette();
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SMOKE PARTICLE SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SC = document.getElementById('smokeCanvas');
const SX = SC.getContext('2d');
let smokeRAF = null;
let smokeParticles = [];

function resizeSmoke(){
  SC.width = window.innerWidth;
  SC.height = window.innerHeight;
}
resizeSmoke();
window.addEventListener('resize', resizeSmoke);

function spawnSmoke(originX, originY){
  const count = 55;
  for(let i = 0; i < count; i++){
    const angle = -Math.PI/2 + (Math.random()-0.5) * Math.PI * 1.1;
    const speed = 0.6 + Math.random() * 2.8;
    smokeParticles.push({
      x: originX + (Math.random()-0.5)*80,
      y: originY + (Math.random()-0.5)*30,
      vx: Math.cos(angle) * speed,
      vy: Math.sin(angle) * speed - 0.5,
      life: 1.0,
      decay: 0.005 + Math.random()*0.008,
      r: 18 + Math.random()*55,
      hue: Math.random() < 0.35 ? 38 : 0,
      sat: Math.random() < 0.35 ? 30 : 0,
    });
  }
}

function drawSmoke(){
  SX.clearRect(0,0,SC.width,SC.height);
  let alive = false;
  for(let p of smokeParticles){
    if(p.life <= 0) continue;
    alive = true;
    p.x += p.vx;
    p.y += p.vy;
    p.vx *= 0.985;
    p.vy *= 0.985;
    p.vy -= 0.012;
    p.r  += 0.55;
    p.life -= p.decay;
    const a = Math.max(0, p.life * 0.22);
    const color = p.hue > 0
      ? `hsla(${p.hue}, ${p.sat}%, 75%, ${a})`
      : `rgba(200,185,160,${a})`;
    const grad = SX.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r);
    grad.addColorStop(0, color);
    grad.addColorStop(1, 'transparent');
    SX.beginPath();
    SX.arc(p.x, p.y, p.r, 0, Math.PI*2);
    SX.fillStyle = grad;
    SX.fill();
  }
  if(alive) smokeRAF = requestAnimationFrame(drawSmoke);
  else {
    SX.clearRect(0,0,SC.width,SC.height);
    smokeParticles = [];
    smokeRAF = null;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  COUNTDOWN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function tick(){
  const d = new Date('2026-04-04T19:00:00') - new Date();
  if(d<=0)return;
  document.getElementById('cdj').textContent=String(Math.floor(d/86400000)).padStart(2,'0');
  document.getElementById('cdh').textContent=String(Math.floor(d%86400000/3600000)).padStart(2,'0');
  document.getElementById('cdm').textContent=String(Math.floor(d%3600000/60000)).padStart(2,'0');
  document.getElementById('cds').textContent=String(Math.floor(d%60000/1000)).padStart(2,'0');
}
tick(); setInterval(tick,1000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  AUDIO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _audioCtx    = null;
let _pageSoundBuf = null;
let _audioLoading = false;
let _audioReady   = false;

async function _initPageSound() {
  if (_audioReady || _audioLoading) return;
  _audioLoading = true;

  try {
    _audioCtx = _audioCtx || new (window.AudioContext || window.webkitAudioContext)();
    if (_audioCtx.state === 'suspended') await _audioCtx.resume();
    const response = await fetch('assets/page.mp3');
    if (!response.ok) throw new Error('HTTP ' + response.status);
    const arrayBuffer = await response.arrayBuffer();
    _pageSoundBuf = await _audioCtx.decodeAudioData(arrayBuffer);
    _audioReady = true;
  } catch (e) {
    console.warn('Page-turn sound load failed:', e);
  } finally {
    _audioLoading = false;
  }
}

function playPageTurnSound() {
  if (!_audioReady) {
    if (!_audioLoading) _initPageSound();
    return;
  }
  try {
    if (_audioCtx.state === 'suspended') _audioCtx.resume();
    const src  = _audioCtx.createBufferSource();
    src.buffer = _pageSoundBuf;
    const gain = _audioCtx.createGain();
    gain.gain.value = 0.8;
    src.connect(gain);
    gain.connect(_audioCtx.destination);
    src.start();
  } catch (e) {
    console.warn('Sound play failed:', e);
  }
}

document.addEventListener('pointerdown', _initPageSound, { once: true });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BOOK OPEN SEQUENCE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const cover       = document.getElementById('cover');
const bookCont    = document.getElementById('bookContainer');
let bookOpen = false;

function openBook(evtX, evtY){
  if(bookOpen) return;
  bookOpen = true;
  cover.style.pointerEvents = 'none';

  const stageR = document.getElementById('stage').getBoundingClientRect();
  const localX = (evtX || (stageR.left + stageR.width/2)) - stageR.left;
  const localY = (evtY || (stageR.top + stageR.height/2)) - stageR.top;
  blowDust(localX, localY);

  const r = cover.getBoundingClientRect();
  const cx = r.left + r.width/2;
  const cy = r.top  + r.height * 0.7;
  spawnSmoke(cx, cy);
  drawSmoke();

  cover.style.transition = 'none';
  let shudder = 0;
  const shudderInt = setInterval(()=>{
    shudder++;
    cover.style.transform = `translateX(${(Math.random()-0.5)*6}px) rotate(${(Math.random()-0.5)*0.8}deg)`;
    if(shudder > 8){
      clearInterval(shudderInt);
      cover.style.transform = '';
      cover.style.transition = 'opacity 0.7s ease, transform 0.7s ease';
      cover.style.opacity = '0';
      cover.style.transform = 'translateY(-12px)';
      setTimeout(()=>{
        cover.style.display = 'none';
        bookCont.style.display = 'block';
        pages.forEach(p => p.classList.remove('visible'));
        pages[cur].classList.add('visible');
        buildDots();
        setTimeout(()=>{
          DC.style.display='none';
          resizeFlipCanvas();
        }, 60);
      }, 700);
    }
  }, 55);
}

cover.addEventListener('click', e=>openBook(e.clientX, e.clientY));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PAGE TURNING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TOTAL = 6;
let cur = 0;
let flipping = false;

const pages = Array.from({length:TOTAL}, (_,i)=>document.getElementById('pg'+i));

const flipCanvas = document.createElement('canvas');
flipCanvas.style.cssText = 'position:absolute;inset:0;z-index:500;pointer-events:none;';
document.getElementById('bookContainer').appendChild(flipCanvas);
const FC = flipCanvas.getContext('2d');

function resizeFlipCanvas(){
  const stage = document.getElementById('stage');
  flipCanvas.width  = stage.offsetWidth;
  flipCanvas.height = stage.offsetHeight;
}
window.addEventListener('resize', resizeFlipCanvas);

function flipTo(next, dir){
  if(flipping || next < 0 || next >= TOTAL || next === cur) return;
  flipping = true;
  resizeFlipCanvas();
  playPageTurnSound();

  const W = flipCanvas.width;
  const H = flipCanvas.height;
  const DURATION = 650;
  const start = performance.now();
  const from = cur;

  pages[from].classList.remove('visible');
  pages[next].classList.add('visible');
  cur = next;
  refreshDots();

  const hasPb = pages[from].querySelector('.pb') !== null;
  const fromBg  = hasPb ? '#ede5cc' : '#f7f0e0';
  const versoBg = '#e8dfc8';

  function ease(t){ return t<0.5 ? 4*t*t*t : 1-Math.pow(-2*t+2,3)/2; }

  function drawPaper(x, y, w, h, color, shadowSide){
    if(w <= 0) return;
    FC.save();
    FC.beginPath(); FC.rect(x, y, w, h); FC.clip();
    FC.fillStyle = color;
    FC.fillRect(x, y, w, h);
    FC.globalAlpha = 0.04;
    for(let ly = y + 24; ly < y + h; ly += 24){
      FC.fillStyle = 'rgba(100,80,40,1)';
      FC.fillRect(x, ly, w, 1);
    }
    FC.globalAlpha = 1;
    const vg = FC.createRadialGradient(x+w/2, y+h/2, h*0.3, x+w/2, y+h/2, Math.max(w,h)*0.9);
    vg.addColorStop(0, 'rgba(0,0,0,0)');
    vg.addColorStop(1, 'rgba(0,0,0,0.08)');
    FC.fillStyle = vg;
    FC.fillRect(x, y, w, h);
    const csw = Math.min(w, 100);
    if(shadowSide === 'right'){
      const sg = FC.createLinearGradient(x+w, y, x+w-csw, y);
      sg.addColorStop(0, 'rgba(0,0,0,0.55)');
      sg.addColorStop(0.4, 'rgba(0,0,0,0.15)');
      sg.addColorStop(1, 'rgba(0,0,0,0)');
      FC.fillStyle = sg;
      FC.fillRect(x+w-csw, y, csw, h);
    } else {
      const sg = FC.createLinearGradient(x, y, x+csw, y);
      sg.addColorStop(0, 'rgba(0,0,0,0.55)');
      sg.addColorStop(0.4, 'rgba(0,0,0,0.15)');
      sg.addColorStop(1, 'rgba(0,0,0,0)');
      FC.fillStyle = sg;
      FC.fillRect(x, y, csw, h);
    }
    FC.restore();
  }

  function drawLiftShadow(edgeX, dir, alpha){
    const sw = W * 0.18;
    let sg;
    if(dir > 0){
      sg = FC.createLinearGradient(edgeX, 0, edgeX + sw, 0);
    } else {
      sg = FC.createLinearGradient(edgeX, 0, edgeX - sw, 0);
    }
    sg.addColorStop(0, `rgba(0,0,0,${alpha * 0.45})`);
    sg.addColorStop(1, 'rgba(0,0,0,0)');
    FC.fillStyle = sg;
    if(dir > 0){
      FC.fillRect(edgeX, 0, Math.min(sw, W - edgeX), H);
    } else {
      FC.fillRect(Math.max(0, edgeX - sw), 0, sw, H);
    }
  }

  function animate(now){
    const rawT = Math.min((now - start) / DURATION, 1);
    const t = ease(rawT);
    FC.clearRect(0, 0, W, H);

    const angle = t * Math.PI;
    const projW  = Math.abs(Math.cos(angle)) * W;
    const phase1 = rawT < 0.5;
    const liftAlpha = Math.sin(angle);

    if(dir > 0){
      const edgeX = projW;
      if(phase1){
        drawPaper(0, 0, projW, H, fromBg, 'right');
        if(projW < W) drawLiftShadow(projW, 1, liftAlpha);
      } else {
        drawPaper(0, 0, projW, H, versoBg, 'right');
      }
    } else {
      const x0 = W - projW;
      if(phase1){
        drawPaper(x0, 0, projW, H, fromBg, 'left');
        if(x0 > 0) drawLiftShadow(x0, -1, liftAlpha);
      } else {
        drawPaper(x0, 0, projW, H, versoBg, 'left');
      }
    }

    if(rawT < 1){
      requestAnimationFrame(animate);
    } else {
      FC.clearRect(0, 0, W, H);
      flipping = false;
    }
  }
  requestAnimationFrame(animate);
}

function nextPage(e){ if(e) e.stopPropagation(); flipTo(cur+1, 1); }
function prevPage(e){ if(e) e.stopPropagation(); flipTo(cur-1,-1); }

function goToCover(e){
  if(e) e.stopPropagation();
  if(flipping || !bookOpen) return;
  flipping = true;
  resizeFlipCanvas();
  playPageTurnSound();

  const W = flipCanvas.width;
  const H = flipCanvas.height;
  const DURATION = 650;
  const start = performance.now();

  pages[cur].classList.remove('visible');
  cur = 0;

  function ease(t){ return t<0.5 ? 4*t*t*t : 1-Math.pow(-2*t+2,3)/2; }

  function animate(now){
    const rawT = Math.min((now - start)/DURATION, 1);
    const t = ease(rawT);
    FC.clearRect(0,0,W,H);

    const angle = t * Math.PI;
    const projW  = Math.abs(Math.cos(angle)) * W;
    const phase1 = rawT < 0.5;
    const liftA  = Math.sin(angle);
    const x0 = W - projW;

    if(phase1){
      if(projW > 0){
        FC.save();
        FC.beginPath(); FC.rect(x0,0,projW,H); FC.clip();
        FC.fillStyle = '#f7f0e0'; FC.fillRect(x0,0,projW,H);
        const csw = Math.min(projW,100);
        const sg = FC.createLinearGradient(x0,0,x0+csw,0);
        sg.addColorStop(0,'rgba(0,0,0,0.5)');
        sg.addColorStop(1,'rgba(0,0,0,0)');
        FC.fillStyle = sg; FC.fillRect(x0,0,csw,H);
        FC.restore();
      }
      if(x0 > 0){
        const sw = W*0.18;
        const sg = FC.createLinearGradient(x0,0,Math.max(x0-sw,0),0);
        sg.addColorStop(0,`rgba(0,0,0,${liftA*0.4})`);
        sg.addColorStop(1,'rgba(0,0,0,0)');
        FC.fillStyle=sg; FC.fillRect(0,0,x0,H);
      }
    } else {
      if(projW > 0){
        FC.save();
        FC.beginPath(); FC.rect(x0,0,projW,H); FC.clip();
        FC.fillStyle = '#1a0e06'; FC.fillRect(x0,0,projW,H);
        const sg = FC.createLinearGradient(W,0,W-Math.min(projW,80),0);
        sg.addColorStop(0,`rgba(0,0,0,${liftA*0.6})`);
        sg.addColorStop(1,'rgba(0,0,0,0)');
        FC.fillStyle=sg; FC.fillRect(x0,0,projW,H);
        FC.restore();
      }
    }

    if(rawT < 1){
      requestAnimationFrame(animate);
    } else {
      FC.clearRect(0,0,W,H);
      bookCont.style.display='none';
      cover.style.display='';
      cover.style.opacity='1';
      cover.style.transform='';
      cover.style.pointerEvents='auto';
      DC.style.display='';
      dustCleared=false;
      bookOpen=false;
      initDust();
      (function redrawDust(){
        DX.clearRect(0,0,DC.width,DC.height);
        for(let p of dustParticles){
          const a=p.alpha;
          const color=p.hue>0?`hsla(${p.hue},${p.sat}%,85%,${a})`:`rgba(210,190,155,${a})`;
          DX.beginPath(); DX.arc(p.x,p.y,p.r,0,Math.PI*2);
          DX.fillStyle=color; DX.fill();
        }
        drawDustVignette();
      })();
      flipping=false;
    }
  }
  requestAnimationFrame(animate);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DOTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildDots(){
  for(let i=0;i<TOTAL;i++){
    const el = document.getElementById('d'+i);
    if(!el) continue;
    el.innerHTML='';
    for(let j=0;j<TOTAL;j++){
      const d = document.createElement('div');
      d.className='dot'+(j===0?' on':'');
      el.appendChild(d);
    }
  }
}
function refreshDots(){
  for(let i=0;i<TOTAL;i++){
    const el=document.getElementById('d'+i);
    if(!el)continue;
    el.querySelectorAll('.dot').forEach((d,j)=>d.classList.toggle('on',j===cur));
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  WIRE BUTTONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function wire(id, fn){
  const el = document.getElementById(id);
  if(el) el.addEventListener('click', fn);
}
wire('btn0l', goToCover); wire('btn0r', nextPage);
wire('btn1l', prevPage);  wire('btn1r', nextPage);
wire('btn2l', prevPage);  wire('btn2r', nextPage);
wire('btn3l', prevPage);  wire('btn3r', nextPage);
wire('btn4l', prevPage);  wire('btn4r', nextPage);
wire('btn5l', prevPage);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  KEYBOARD + SWIPE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('keydown', e=>{
  if(!bookOpen){ openBook(); return; }
  if(e.key==='ArrowRight') nextPage(null);
  if(e.key==='ArrowLeft')  prevPage(null);
});
let tx=0;
document.addEventListener('touchstart',e=>{ tx=e.touches[0].clientX; },{passive:true});
document.addEventListener('touchend',e=>{
  if(!bookOpen) return;
  const dx=e.changedTouches[0].clientX - tx;
  if(Math.abs(dx)<50) return;
  dx<0 ? nextPage(null) : prevPage(null);
},{passive:true});
</script>
</body>
</html>
